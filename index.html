<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="js/scripts.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <title>Odin calculator</title>
</head>
<body>
    <div class="main-container">
        <div id="calculator">
            <div id="c_screen">
                <p class="screen text top">0</p>
                <p class="screen text operator">1</p>
                <p class="screen text bottom">2</p>
            </div>
            <div class="keypad">
                <div class="button-row">
                    <button class="btn special c expanding">C</button>
                    <!-- <button class="btn para">()</button> -->
                    <button class="btn op percent">%</button>
                    <button class="btn op divide">/</button>
                </div>
                <div class="button-row">
                    <button class="btn numeric 7">7</button>
                    <button class="btn numeric 8">8</button>
                    <button class="btn numeric 9">9</button>
                    <button class="btn op multi">*</button>
                </div>
                <div class="button-row">
                    <button class="btn numeric 4">4</button>
                    <button class="btn numeric 5">5</button>
                    <button class="btn numeric 6">6</button>
                    <button class="btn op minus">-</button>
                </div>
                <div class="button-row">
                    <button class="btn numeric 1">1</button>
                    <button class="btn numeric 2">2</button>
                    <button class="btn numeric 3">3</button>
                    <button class="btn op plus">+</button>
                </div>
                <div class="button-row">
                    <button class="btn special plusminus">+/-</button>
                    <button class="btn numeric 0">0</button>
                    <button class="btn special dot">.</button>
                    <button class="btn special eq">=</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let screen = document.querySelector("#c_screen");
        let a;
        let b;
        let result;
        let position = 2;
        let op_switch = 0;

        // A function that will update the calculator screen, intended to be
        // usable generically
        function updateScreen(result, position) {
            if (position === 0 || position === 2) {
                screen.children[position].textContent = 
                result === "" ? "":
                String(Number(result));
            } else {
                screen.children[position].textContent = String(result);
            }
        }

        // All numerical buttons' content will be used directly
        let btn_numeric = document.querySelectorAll(".btn.numeric");
        for (let btn_idx = btn_numeric.length - 1; btn_idx >= 0; btn_idx--) {
            btn_numeric[btn_idx].addEventListener("click", appendNumber)
        }

        // Clear button, reverts screen to default value
        let btn_clear = document.querySelector(".btn.c");
        btn_clear.addEventListener("click", clearScreen);

        // The approach currently is to append numerical values
        // by reading the screen directly
        function appendNumber(e) {
            let btn_value = e.target.textContent;
            result = screen.children[position].textContent + btn_value;
            updateScreen(result, position);
            // return Number(btn_value.textContent)
        }

        // Clear screen, or C, button functionality
        function clearScreen() {
            updateScreen("", 0); // top calculator row
            updateScreen("", 1); // middle >> >>
            updateScreen(0, 2); // bottom >> >>
            screen.children[2].style.color = "";
        }

        let btn_operator = document.querySelectorAll(".op");
        for (let btn_idx = btn_operator.length - 1; btn_idx >= 0; btn_idx--) {
            btn_operator[btn_idx].addEventListener("click", sendOperation)
        }

        const operations = {
            "%": percentage,
            "/": divide,
            "*": multiply,
            "-": minus,
            "+": plus,
        };

        function sendOperation(e) {
            console.log(e.target.textContent);
            console.log(operations[e.target.textContent])
        }

        function percentage(a) {
            return divide(a, 100);
        }

        function divide(a, b) {
            return a / b;
        }

        function multiply(a, b) {
            return a * b;
        }

        function minus(a, b) {
            return a - b;
        }

        function plus(a, b) {
            return a + b;
        }

        let btn_equals = document.querySelector(".eq");
        btn_equals.addEventListener("click", equals);
        function equals(e) {
            if (screen.children[0].textContent === "") {
                updateScreen(screen.children[2].textContent, 0);
                updateScreen("/", 1);
                updateScreen("", 2);
            } else {
                a = Number(screen.children[0].textContent);
                b = Number(screen.children[2].textContent);
                result = a/b;
                updateScreen(String(result), 0);
                updateScreen("/", 1);
                updateScreen("", 2);
            }
        }

        // Initial value for calculator
        clearScreen();
    </script>
</body>
</html>